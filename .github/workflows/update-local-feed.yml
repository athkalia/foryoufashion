name: Update Local Inventory Feed

on:
  schedule:
    - cron: '0 0 * * *' # Runs daily at midnight
  workflow_dispatch: # Allows manual triggering of the workflow

jobs:
  update-feed:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install Kotlin
        run: |
          sudo apt-get update
          sudo apt-get install -y curl
          curl -s https://get.sdkman.io | bash
          source "$HOME/.sdkman/bin/sdkman-init.sh"
          sdk install kotlin

      - name: Run Kotlin Script
        run: |
          mkdir -p build
          kotlinc -cp . -include-runtime -d build/GenerateLocalProductFeed.jar src/main/kotlin/generatelocalproductfeed/GenerateLocalProductFeed.kt
          java -cp build/GenerateLocalProductFeed.jar generatelocalproductfeed.GenerateLocalProductFeedKt

      - name: Upload XML artifact
        uses: actions/upload-artifact@v2
        with:
          name: updated-local-inventory
          path: updated_local_inventory.xml
